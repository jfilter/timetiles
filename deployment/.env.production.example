# Production Environment Configuration
# Copy this file to .env.production and fill in your values

# ==========================================
# Docker Compose Configuration
# ==========================================
# Project name (used for container names)
COMPOSE_PROJECT_NAME=timetiles

# Image configuration
# For production, use pre-built images from GitHub Container Registry
TIMETILES_IMAGE=ghcr.io/jfilter/timetiles
TIMETILES_VERSION=latest
# Pin to specific version for stability:
# TIMETILES_VERSION=v1.0.0

# ==========================================
# Database Configuration
# ==========================================
DB_NAME=timetiles
DB_USER=timetiles_user
DB_PASSWORD=CHANGE_ME_STRONG_PASSWORD
DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@postgres:5432/${DB_NAME}

# PostgreSQL/PostGIS image configuration
# Default: kartoza/postgis (multi-arch: amd64 + arm64)
# For x86-only production servers, you can use: postgis/postgis
# POSTGRES_IMAGE=kartoza/postgis
POSTGRES_VERSION=17-3.5

# PostgreSQL tuning (optional - defaults are optimized for 2GB RAM)
# PG_MAX_LOCKS=1024
# PG_STACK_DEPTH=7680kB
# PG_WORK_MEM=32MB
# PG_SHARED_BUFFERS=256MB
# PG_MAX_CONNECTIONS=100
# PG_CACHE_SIZE=1GB
# PG_MAINTENANCE_MEM=128MB
# PG_LOG_STATEMENT=none

# ==========================================
# Payload CMS Configuration
# ==========================================
# Generate with: openssl rand -base64 32
PAYLOAD_SECRET=CHANGE_ME_RANDOM_32_CHAR_SECRET

# Your production domain (e.g., timetiles.example.com)
DOMAIN_NAME=your-domain.com
NEXT_PUBLIC_PAYLOAD_URL=https://${DOMAIN_NAME}

# ==========================================
# Application Settings
# ==========================================
NODE_ENV=production

# Port configuration
HOST_PORT=3000          # Port exposed on host machine
CONTAINER_PORT=3000     # Port inside container

# Logging
LOG_LEVEL=info

# ==========================================
# Nginx & SSL Configuration
# ==========================================
# NGINX_VERSION=alpine
# HTTP_PORT=80
# HTTPS_PORT=443
# NGINX_CONF_PATH=./deployment/nginx/nginx.conf

# Email for Let's Encrypt notifications
LETSENCRYPT_EMAIL=admin@${DOMAIN_NAME}

# ==========================================
# Email Configuration (SMTP)
# ==========================================
# Required for sending emails (registration, password reset, etc.)
EMAIL_SMTP_HOST=smtp.example.com
EMAIL_SMTP_PORT=587
EMAIL_FROM=noreply@${DOMAIN_NAME}
# Optional: SMTP authentication
# EMAIL_SMTP_USER=your-smtp-user
# EMAIL_SMTP_PASS=your-smtp-password

# ==========================================
# File Upload Configuration
# ==========================================
# Host directory for uploads (bind-mounted into the container)
# Subfolders are created automatically: /media and /import-files
UPLOAD_HOST_DIR=./uploads
# Container-internal path (should not need changing)
UPLOAD_DIR=/app/apps/web/uploads
# =============================================================================
# Backup Configuration
# =============================================================================

# Backup encryption password (KEEP THIS SECURE)
RESTIC_PASSWORD=

# Local backup repository
RESTIC_REPOSITORY=/opt/timetiles/backups/restic-repo

# Offsite S3-compatible storage (optional)
# RESTIC_OFFSITE_REPOSITORY=s3:s3.amazonaws.com/your-bucket/timetiles
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_ENDPOINT_URL=

# Retention policy
BACKUP_KEEP_DAILY=7
BACKUP_KEEP_WEEKLY=4
BACKUP_KEEP_MONTHLY=12
