# Permissions and Quotas

The permission system manages user access levels and resource usage limits through trust levels and quotas.

## Trust Levels

Users are assigned trust levels that determine their access to features:

| Level | Name | Description |
|-------|------|-------------|
| 0 | NEW_USER | New accounts with basic access |
| 1 | BASIC | Verified users with standard limits |
| 2 | TRUSTED | Established users with higher limits |
| 3 | POWER_USER | Advanced users with extended capabilities |
| 4 | ADMIN | Full system access |

## Quotas

Each trust level has different resource limits:

### Import Quotas

| Trust Level | Daily Imports | Max File Size | Events per Import |
|------------|---------------|---------------|-------------------|
| NEW_USER | 5 | 10 MB | 1,000 |
| BASIC | 20 | 50 MB | 10,000 |
| TRUSTED | 100 | 200 MB | 50,000 |
| POWER_USER | 500 | 1 GB | 250,000 |
| ADMIN | Unlimited | Unlimited | Unlimited |

### URL Fetch Quotas

| Trust Level | Daily Fetches | Hourly Fetches | Max Response Size |
|------------|---------------|----------------|-------------------|
| NEW_USER | 10 | 5 | 5 MB |
| BASIC | 50 | 20 | 25 MB |
| TRUSTED | 200 | 50 | 100 MB |
| POWER_USER | 1,000 | 200 | 500 MB |
| ADMIN | Unlimited | Unlimited | Unlimited |

### Storage Quotas

| Trust Level | Total Events | Total Datasets | Media Storage |
|------------|--------------|----------------|---------------|
| NEW_USER | 5,000 | 5 | 100 MB |
| BASIC | 50,000 | 25 | 1 GB |
| TRUSTED | 500,000 | 100 | 10 GB |
| POWER_USER | 5,000,000 | 500 | 100 GB |
| ADMIN | Unlimited | Unlimited | Unlimited |

## Quota Enforcement

Quotas are enforced at multiple levels:

1. **Pre-check**: Before operations begin
2. **Runtime**: During processing
3. **Post-validation**: After completion

When quotas are exceeded:
- Operation is blocked with clear error message
- User is notified of current usage and limits
- Suggestions for upgrading trust level

## API Responses

### Quota Check Response

```json
{
  "allowed": true,
  "current": 15,
  "limit": 50,
  "remaining": 35,
  "resetAt": "2024-01-15T00:00:00Z"
}
```

### Quota Exceeded Response

```json
{
  "error": "QUOTA_EXCEEDED",
  "message": "Daily import limit reached",
  "quota": {
    "type": "import",
    "period": "daily",
    "current": 20,
    "limit": 20,
    "resetAt": "2024-01-15T00:00:00Z"
  },
  "suggestion": "Upgrade to TRUSTED level for higher limits"
}
```

## Permission Checks

The system automatically checks permissions for:

- File uploads
- Import job creation
- URL fetch operations
- Dataset creation
- Event creation
- Media uploads

## Usage Tracking

All resource usage is tracked and visible in:

- User profile (`/admin/users`)
- Activity logs
- Admin dashboard

## Trust Level Progression

Users can progress through trust levels based on:

- Account age
- Successful imports
- Data quality
- Community contributions
- Admin approval

## Configuration

Environment variables:

```bash
# Enable/disable quota enforcement
ENABLE_QUOTAS=true

# Custom quota multipliers
QUOTA_MULTIPLIER_IMPORT=1.0
QUOTA_MULTIPLIER_FETCH=1.0
QUOTA_MULTIPLIER_STORAGE=1.0
```