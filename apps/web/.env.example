# Environment configuration for TimeTiles
# Copy this to apps/web/.env and adjust values as needed
# Note: Next.js also supports .env.local for local overrides

# Database connection (REQUIRED)
# This is used as the base for all database connections
# Test databases will be derived from this (e.g., timetiles_test, timetiles_test_1, etc.)
DATABASE_URL=postgresql://timetiles_user:timetiles_password@localhost:5432/timetiles

# Payload CMS configuration
PAYLOAD_SECRET=your-secret-key-here
NEXT_PUBLIC_PAYLOAD_URL=http://localhost:3000
# PAYLOAD_PREVIEW_SECRET is no longer used - preview mode uses JWT-only authentication

# Environment
NODE_ENV=development

# Geocoding Services (for Event Import System)
# Geocoding providers are configured through the Payload admin panel at /admin/geocoding-providers
# No environment variables required - manage API keys and settings in the UI

# File Upload Configuration
# Maximum file sizes in bytes
MAX_FILE_SIZE_AUTHENTICATED=104857600  # 100MB for authenticated users
MAX_FILE_SIZE_UNAUTHENTICATED=10485760 # 10MB for unauthenticated users

# Upload Directory Configuration
# Configure where uploaded files are stored (relative to apps/web or absolute paths)
UPLOAD_DIR_MEDIA=media                 # Directory for media uploads (images)
UPLOAD_DIR_IMPORT_FILES=import-files   # Directory for import file uploads
UPLOAD_TEMP_DIR=./tmp                  # Temporary directory for file processing

# Rate Limiting Configuration (for unauthenticated users)
RATE_LIMIT_FILE_UPLOAD=5      # 5 uploads per hour
RATE_LIMIT_PROGRESS_CHECK=100 # 100 progress checks per hour
RATE_LIMIT_API_GENERAL=50     # 50 general API requests per hour
RATE_LIMIT_WINDOW_MS=3600000  # 1 hour window in milliseconds

# Batch Processing Configuration
# Adjust these values to tune performance vs memory usage
BATCH_SIZE_DUPLICATE_ANALYSIS=5000   # Memory efficient for duplicate detection
BATCH_SIZE_SCHEMA_DETECTION=10000    # Larger batches for schema building efficiency
BATCH_SIZE_EVENT_CREATION=1000       # Smaller to avoid transaction timeouts
BATCH_SIZE_DATABASE_CHUNK=1000       # Database query chunk size

# Cache Configuration
GEOCODING_CACHE_CLEANUP_DAYS=90 # Days before cleaning up unused cache entries
GEOCODING_CACHE_MIN_HITS=3      # Minimum hits required to keep cache entry

# Cache Configuration (generic cache system)
CACHE_BACKEND=filesystem        # Cache backend: memory or filesystem
CACHE_DEFAULT_TTL=3600          # Default cache TTL in seconds (1 hour)
CACHE_MAX_SIZE_MB=500           # Maximum cache size in MB
CACHE_MAX_ENTRIES=1000          # Maximum number of cache entries (memory backend)
CACHE_DIR=.cache                # Base cache directory (filesystem backend)
CACHE_CLEANUP_INTERVAL_MS=3600000 # Cache cleanup interval (1 hour)

# URL Fetch Cache Configuration (for scheduled URL imports - outgoing requests)
URL_FETCH_CACHE_DIR=/tmp/url-fetch-cache  # Directory for URL fetch cache storage
URL_FETCH_CACHE_MAX_SIZE=104857600   # Maximum size of URL fetch cache in bytes (100MB)
URL_FETCH_CACHE_TTL=3600             # Default TTL for URL fetch cache entries in seconds
URL_FETCH_CACHE_RESPECT_CACHE_CONTROL=true  # Respect Cache-Control headers from external APIs

# Note: Test databases are automatically derived from DATABASE_URL
# - E2E tests use: ${database}_test (e.g., timetiles_test)
# - Unit/Integration tests use: ${database}_test_${worker_id} (e.g., timetiles_test_1, timetiles_test_2)

# Email Configuration
# Without SMTP settings, emails are logged to console (ethereal.email) in development
EMAIL_FROM_ADDRESS=noreply@timetiles.app
EMAIL_FROM_NAME=TimeTiles
# EMAIL_SMTP_HOST=smtp.example.com
# EMAIL_SMTP_PORT=587
# EMAIL_SMTP_USER=your-smtp-user
# EMAIL_SMTP_PASS=your-smtp-password

# Optional: Redis for distributed rate limiting (future enhancement)
# REDIS_URL=redis://localhost:6379

# Optional: Webhook notifications (future enhancement)
# WEBHOOK_SECRET=your-webhook-secret
# WEBHOOK_URL=https://your-app.com/webhooks/import-complete
